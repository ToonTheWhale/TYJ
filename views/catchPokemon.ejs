<%- include('partials/header'); %>
<main style="margin-bottom: 100px;">
  <section class="flex-container-sengle-item" id="flex-container-sengle-item" style="position: relative;">
    <article>
        <figure>
          <h2>????????</h2>
          <img src="/images/Question-mark.png" />
        </figure>
        <aside class="layer" id="#button" style="flex-direction: column;">
            <button onclick="openPopup()" type="submit">kiezen</button>
            <p style="color: white; font-size: 35px;">of</p>
            <button onclick="selectRandomPokemon()" type="submit">Random</button>
          </aside>
      </a>
      <button
        type="submit"
        class="pokeball"
        id="pokeball"
        style="animation: none; position: absolute; bottom: -25%; left: 25%; background:linear-gradient(to bottom, rgb(62, 59, 59) 0 80px, black 81px 96px, white 97px 100%) "
      ></button>
    </article>
  </section>

    <!-- popup code  -->

    <dialog id="popup" class="popup">
        <h2>Selecteer een Pok√©mon</h2>
        <input
          type="text"
          id="myInput"
          onkeyup="filterPokemonByName()"
          placeholder="Pokemon zoeken ..."
        />
        <section class="image-container">
          <% for(let pokemon of pokemons) { %>
          <article>
            <figure>
              <img
                src="<%= pokemon.image %>"
                onclick="selectPokemon('<%= pokemon.name %>')"
              />
              <figcaption>
                <p><%= pokemon.name %></p>
              </figcaption>
            </figure>
          </article>
          <% } %>
        </section>
        <button onclick="closePopup()" id="button">Close</button>
    </dialog>
    <div id="overlay" class="overlay"></div>
</main>
<script>

    async function fetchAndProcessSinglePokemonData(pokemonID) {
        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonID}/#`);
        const singlePokemon = await response.json();
        const pokemonData = {
        id: singlePokemon.id,
        name: singlePokemon.name,
        types: singlePokemon.types.map(type => type.type.name),
        image: singlePokemon.sprites.front_default,
        height: singlePokemon.height,
        weight: singlePokemon.weight,
        maxHP: singlePokemon.stats[0].base_stat,
        defense: singlePokemon.stats[2].base_stat,
        attack: singlePokemon.stats[1].base_stat,
        };
        return pokemonData;
    }

    // Functie om de pop-up te openen
    function openPopup() {
      document.getElementById("popup").style.display = "block";
      document.getElementById("overlay").style.display = "block";
    }

    // Functie om de pop-up te sluiten
    function closePopup() {
      document.getElementById("popup").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    // Functie om een pokemon te selecteren
    function selectPokemon(pokemonName) {
      alert(`Jij hebt ${pokemonName} geselecteerd`);
      closePopup();
      fetchAndProcessSinglePokemonData(pokemonName)
      .then(pokemon => { switchToSelectedPokemon(pokemon); })
    }

    function RandomNumber() {
        return Math.floor(Math.random() * 151);
    }

    function selectRandomPokemon() {
        selectPokemon(RandomNumber())
    }

    // Functie om een pokemon te selecteren
    function switchToSelectedPokemon(pokemon) {
      const defaultElement = document.getElementById("flex-container-sengle-item");
      const article = document.createElement("article");
      article.className = "flex-container-sengle-item"
      article.innerHTML = 
        `
        <section style="position: relative;">
            <article>
                <figure>
                <h2> ${pokemon.name} </h2>
                <img src="${pokemon.image}" />
                </figure>
                <aside class="layer-close-button">
                <button style="margin: 15px;" onclick="openPopup()" type="submit">X</button>
                </aside>
            </a>
                <button
                    type="submit"
                    class="pokeball"
                    id="pokeball"
                    style="animation: none; position: absolute; bottom: -25%; left: 25%"
                ></button>
            </article>
        </section>
        `;
        if (defaultElement) {
          defaultElement.replaceWith(article) 
        } else {
          const defaultElement = document.getElementsByClassName("flex-container-sengle-item")[0]
          defaultElement.replaceWith(article)
        }
    }

    // Functie om een Pokemon op naam te filteren
    function filterPokemonByName() {
      var input,filter,imageContainer,articles,figure,figcaption,p,i,txtValue;
      
      input = document.getElementById("myInput");
      filter = input.value.toUpperCase();
      imageContainer = document.querySelector(".image-container");
      articles = imageContainer.getElementsByTagName("article");

      for (i = 0; i < articles.length; i++) {
        figure = articles[i].getElementsByTagName("figure")[0];
        p = figure.getElementsByTagName("p")[0];
        txtValue = p.textContent || p.innerText;

        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          articles[i].style.display = "";
        } else {
          articles[i].style.display = "none";
        }
      }
    }

  </script>
  <%- include('partials/footer'); %>
